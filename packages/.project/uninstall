#!/bin/bash

set -eu
set -o pipefail

PRJ_PATH="`dirname \"${BASH_SOURCE[0]}\"`"
if [[ ! -d "$PRJ_PATH" ]]; then PRJ_PATH="$PWD"; fi
PRJ_PATH="`( cd -P \"$PRJ_PATH\" && pwd )`"
source "$PRJ_PATH/configs"
source "$PRJ_PATH/paths"

if [[ -d /usr/local/stow/"$PKG_NAME"_"$BLD_NAME" ]]; then
  if [[ ! -d $DST_PATH ]]; then
    mkdir $DST_PATH
  fi

  cd /usr/local/stow
  sudo stow -v -D "$PKG_NAME"_"$BLD_NAME"

  if [[ -L /usr/local/stow/"$PKG_NAME"_"$BLD_NAME" ]]; then
    sudo rm "$PKG_NAME"_"$BLD_NAME"
  else
    sudo mv -v "$PKG_NAME"_"$BLD_NAME" $DST_PATH/$BLD_NAME
  fi
fi
