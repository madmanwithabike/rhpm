#!/bin/bash

set -eu
set -o pipefail

PRJ_PATH="$(dirname "${BASH_SOURCE[0]}")"
if [[ ! -d "$PRJ_PATH" ]]; then PRJ_PATH="$PWD"; fi
PRJ_PATH="$(cd -P "$PRJ_PATH" && pwd)"
source "$PRJ_PATH/configs"
source "$PRJ_PATH/paths"

./dependencies/$DEP_NAME

cd $SRC_PATH
git checkout $SRC_VERSION

if [[ ! -d $BLD_PATH ]]; then
  mkdir $BLD_PATH
fi

cd $BLD_PATH
cmake -DCMAKE_TOOLCHAIN_FILE=~/cmake/gnu-gcc.cmake \
      -DCMAKE_INSTALL_PREFIX=/usr/local/stow/"${PKG_NAME}_${BLD_NAME}" \
      $SRC_PATH
