#!/bin/bash

# https://stackoverflow.com/a/13478622
set -eu
set -o pipefail

DIR="`dirname \"${BASH_SOURCE[0]}\"`"
if [[ ! -d "$DIR" ]]; then DIR="$PWD"; fi
source "$DIR/configs"
source "$DIR/paths"
unset DIR

rm -v -f -r $BLD_PATH

cd $SRC_PATH

# discard stuff from last build
git reset --hard

# Go back to master HEAD
git checkout master

# delete all of the last build stuff
git clean -xdf

# get latest update
git pull

git checkout "$SRC_VERSION"

patch -p1 --no-backup-if-mismatch < "$PRJ_PATH"/patch/no-cache.patch
